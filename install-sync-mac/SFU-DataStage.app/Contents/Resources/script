cp -R unison /usr/bin/
cp datastage.sh ~/.datastage.sh

mkdir ~/datadisk
mkdir -p ~/.unison/backup
chown -R $USER ~/datadisk
# create shortcut to backups dir and readme
ln -s ~/.unison/backup ~/datadisk/backup

echo 'In the event that you and a colleague are working on the same file simultaneously and changes are lost during the sync process, an old version of the file will be created in the backup folder.' > ~/datadisk/readme.txt

# get SFU credentials â€“ OSX
OLD_IFS="$IFS"
IFS=$'\n'
CD="CocoaDialog.app/Contents/MacOS/CocoaDialog"
user=($($CD standard-inputbox --title "DataStage Install" --informative-text "Enter your SFU Computing ID"))
user=${user[1]}
pass=($($CD standard-inputbox --title "DataStage Install" --informative-text --string-output "Enter your SFU Computing Password" --no-show))
pass=${pass[1]}

echo -e '#test for network conection\nfor interface in $(ls /sys/class/net/ | grep -v lo);\ndo\n  if [[ $(cat /sys/class/net/$interface/carrier) = 1 ]]; then\nunison ~/datadisk ssh://'$user'@datadisk.lib.sfu.ca/srv/datastage/private/'$user' -batch -backups -prefer root -ignore="Name *.tmp" -ignore="Name *~" -rsrc=false -ignore="Name .FBCIndex" -ignore="Name .FBCLockFolder\nfi\ndone' > ~/.datastage.sh

# test if ssh key already exists; else generate one
if [ ! -e ~/.ssh/id_rsa.pub ];
then
ssh-keygen -q -t rsa -f ~/.ssh/id_rsa -N "" -C $user'@sfu.ca'
fi

tar -zxf sshpass-1.04.tar.gz
cd sshpass-1.04
./configure
make
make install
./sshpass -p $pass ssh-copy-id $user@datadisk.lib.sfu.ca
cd ..
rm -r sshpass-1.04

# Add to /etc/crontab
croncommand="~./datastage.sh"
cronjob="*/5 * * * * $croncommand"
cat <(fgrep -i -v "$croncommand" <(crontab -l)) <(echo "$cronjob") | crontab -